<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>game</title>
	<style>
	html,
	body{
		width:100%;
		height:100%;
	}
	#p1{
		float:left;
		width:30%;
	}
	#res{
		float:left;
		width:40%;
		background-color: #eee;
		line-height: 30px;
		height:500px;
		overflow-y:scroll; 
	}
	#p2{
		float:right;
		width:30%;
	}
	#mask{
		width:100%;
		height:100%;
		text-align: center;
		line-height: 400px;
		color:white;
		background-color: #000;
		position: fixed;
		top:0;
		left:0;
		z-index: 1000;
	}
	</style>
</head>
<body>
	<div id="p1"></div>
	<div id="res"></div>
	<div id="p2"></div>
	<div id="mask"></div>
	<script src="leo.js"></script>
	<script>
	var images = [];
	var imgCount = 1;
	for(var i = 1; i < 94; i++){		
		images[i] = new Image();
		images[i].src = 'img/' + i + ".gif";
		images[i].onload = function(){
			imgCount++;
			if(imgCount == 93){
				l(l.id('mask')).css({'display':"none"});

				var res = l(l.id('res'));
		var deadImg = new Image();
		deadImg.src = "img/"
		function makeName(nameNum){
			var nn = nameNum || 2;
			var nameStr = '拉屎肯定附件拉开是的甲方绿卡是的甲方卢卡斯大家发了拉开水电费就拉克丝低功耗拉斯科电话伐啦开始大家发了阿拉丁是否急哦而我却恩开箱子了参加哦切附件十大脾气外婆我去哦女阿克江发挥其偶i恶化人劳科叫撒规范矩鞍环是滴覅驱蚊器哦你先忙着大厦防洪渠我额祭夜血泣星耀使者凉城深巷璃心易碎六弦绿漪海水枯竭狂月哮天霸欲、天下凉薄骚年开阔蓝天碍我者亡帅裂苍穹山河枯荣初夏浅唱傲视之巅怪咖达人風聲提筆攀附寂寞屎里逃生万贱穿心陌上烟雨兔子先生左墙听雨桑榆未晚青空杳然无始大帝为你独霸孤者何惧异域之巅打小就帅輓揂隨風亡心少女顛鸞倒鳳南昔烈酒遠風襲人纯白梵唱烟云似雪北葵向暖春暖花俊青衣挽素墨道刺青港湾少女大攻无量恍然如梦七月恋歌平胸女王跩跩灬尒仯泠雨喧嚣深碍久绊萌面大盗聖劍权倾婲謝夕顏夏末╮悲叹挥笔朝夕今夕何夕壹身傲氣时光流逝燈火輝煌半陌路人日暮古稀静水深流一路迷惘雨巷猫咪泪泯烈酒酒笙清栀月寒心冷斩尽メ天下月下鹰翔';
			var name = "";
			for(var i = 0; i < nn; i++){
				name += nameStr[~~(Math.random() * nameStr.length)];
			} 
			return name;
		}



		var Person = function(){
			this.name = makeName(~~(Math.random() * 4) + 1);
			this.body = "img/" + Math.round(l.random(1,93)) + ".gif";
			this.HP = 100;
			this.MP = 100;
			this.ad = ~~(Math.random() * 20) + 1;
			this.md = ~~(Math.random() * 20) + 1;
			this.bao = Math.random() * 100;
			this.skip = Math.random() * 100;
			this.speed = Math.random() * 3000 + 1000;
			this.def = ~~(Math.random() * 10);
		}
		Person.prototype = {
			dead:function(enemy,callback){
				res.html(this.name + " 被 " + enemy.name + " 击杀了<br>" + res.html());
				if(l.isFunction(callback)){
					callback();
				}
			},
			attack:function(enemy){
				var b = 1 + 1 * l.random(0.1,1).toFixed(1);//暴击伤害倍数
				var str;
				var atk = (this.ad - enemy.def) > 1 ? this.ad - enemy.def : 1 ;
				if(l.random() * 100 < enemy.skip){
					str = "<b style='color:blue;'>" +enemy.name + "</b>" + " 闪避了 " + "<b style='color:blue;'>" + this.name + "</b> 的攻击 <br>"; 
				}else{
					if(l.random(0,100) < this.bao){
						atk = Math.round(atk * b);
						enemy.HP -= atk; 
						str = "<b style='color:blue;'>" +enemy.name + "</b>" + " 被 " + "<b style='color:blue;'>" + this.name + "</b>" + " 砍出 <span style='color:red;'>"+ b + "倍暴击，</span>掉了<span style='color:red;'>" + atk + "</span>" + " 滴血 <br>"
					}else{
						enemy.HP -= atk; 
						str = "<b style='color:blue;'>" +enemy.name + "</b>" + " 被 " + "<b style='color:blue;'>" + this.name + "</b>" + " 砍掉 " + "<span style='color:red;'>" + atk + "</span>" + " 滴血 <br>"
					}
				}
				// console.log(this.name + "砍掉了" + enemy.name + atk + "滴血");
				res.html(str + res.html());
			},
			render:function(id){
				var dom = l(l.id(id));
				dom.html(" ")
				var body = l.create({
					tag:'img',
					property:{
						src:this.body
					}
				})
				body.style.width = "200px";
				body.style.height = "200px";
				var name = l.create({
					tag:'div',
					content:'名字:' + this.name
				})
				var hp = l.create({
					tag:'div',
					content:'血量:' + this.HP
				})
				var mp = l.create({
					tag:'div',
					content:'魔力:' + this.MP
				})
				var ad = l.create({
					tag:'div',
					content:'攻击:' + this.ad
				})
				var md = l.create({
					tag:'div',
					content:'魔法:' + this.md
				})
				var def = l.create({
					tag:'div',
					content:'防御:' + this.def
				})
				var bao = l.create({
					tag:'div',
					content:'暴击:' + this.bao.toFixed(1) + "%"
				})
				var skip = l.create({
					tag:'div',
					content:'闪避:' + this.skip.toFixed(1) + "%"
				})
				var speed = l.create({
					tag:'div',
					content:'攻速:' + this.speed.toFixed(1)
				})
				dom.append(body);
				dom.append(name);
				dom.append(hp);
				dom.append(mp);
				dom.append(ad);
				dom.append(md);
				dom.append(def);
				dom.append(skip);
				dom.append(speed);
				dom.append(bao);
			}
		}

		function　battle(p1,p2){
			var timer1,timer2;
			function b1(){
				timer1 = setTimeout(function(){
					b1()
					// var _atk = (p1.ad - p2.def) > 1 ? p1.ad - p2.def : 1 ;
					// p2.HP -= _atk;
					// res.html(res.html() + p2.name + " 被 " + p1.name + " 砍掉 " + _atk + " 滴血 <br>");
					p1.attack(p2);

					if(p2.HP <= 0){
						p2.HP = 0;
						p2.dead(p1);

						p2 = new Person();
						p1.HP = 100;
						p1.MP = 100;
						battle(p1,p2);

						p2.render('p2');
						clearTimeout(timer1);
						clearTimeout(timer2);
					}
					p2.render('p2');
				},p1.speed)
			}
			b1()
			function b2(){
				timer2 = setTimeout(function(){
					b2()
					// var _atk = (p2.ad - p1.def) > 1 ? p2.ad - p1.def : 1 ;
					// p1.HP -= _atk;
					// res.html(res.html() + p1.name + " 被 " + p2.name + " 砍掉 " + _atk + " 滴血 <br>");
					p2.attack(p1);
					if(p1.HP <= 0){
						p1.HP = 0;
						p1.dead(p2);

						p1 = new Person();
						p2.HP = 100;
						p2.MP = 100;
						p1.render('p1');
						battle(p1,p2);
						clearTimeout(timer1);
						clearTimeout(timer2);
					}
					p1.render('p1');
				},p2.speed)
			}
			b2()
		}
		var att = new Person();
		var def = new Person();
		att.render('p1')
		def.render('p2')
		battle(att,def);



			}else{
				l(l.id('mask')).html("正在加载图片,请稍等.......<br>" + imgCount + "/93");
			}
		}
	}
		
	</script>
</body>
</html>